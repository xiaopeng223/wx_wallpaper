{"version":3,"file":"classlist.js","sources":["pages/classlist/classlist.vue","D:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvY2xhc3NsaXN0L2NsYXNzbGlzdC52dWU"],"sourcesContent":["<template>\r\n\t<view class=\"classlist\">\r\n\t\t<view class=\"loadingLayout\" v-if=\"!classList.length && !noData\">\r\n\t\t\t<uni-load-more status=\"loading\"></uni-load-more>\r\n\t\t</view>\r\n\t\t<view class=\"content\">\r\n\t\t\t<navigator :url=\"'/pages/preview/preview?id=' + item._id\" class=\"item\" v-for=\"item in classList\"\r\n\t\t\t:key=\"item._id\">\r\n\t\t\t\t<image :src=\"item.smallPicurl\" mode=\"aspectFill\"></image>\r\n\t\t\t</navigator>\r\n\t\t</view>\r\n\t\t<view class=\"loadingLayout\" v-if=\"classList.length || noData\">\r\n\t\t\t<uni-load-more :status=\" noData ? 'noMore':'loading'\"></uni-load-more>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script setup>\nimport { ref } from 'vue';\r\nimport {onLoad, onReachBottom,onShareAppMessage,onShareTimeline} from \"@dcloudio/uni-app\"\r\nimport {apiGetClassList,apiGetHistoryList} from \"@/apis/apis.js\"\r\nconst classList = ref([])\r\nconst noData = ref(false)\r\nlet pageName;\r\n//获取url传递的id\r\nconst queryParams = {\r\n\tpageNum:1,\r\n\tpageSize:12\r\n}\r\nonLoad((e)=>{\r\n\tlet {id=null,name=null,type=null} = e;\r\n\tif(type) queryParams.type = type;\r\n\tif(id) queryParams.classid = id;\r\n\tpageName = name\r\n\tuni.setNavigationBarTitle({\r\n\t\ttitle:name\r\n\t})\r\n\t//onLoad加载在setup语法糖之后\r\n\tgetClassList();\r\n})\r\n//获取分类列表\r\nconst getClassList = async () => {\n\ttry {\n\t\tlet res;\n\n\t\t// 根据业务逻辑优先级判断到底调用哪个接口\n\t\tif (queryParams.classid) {\n\t\t\tres = await apiGetClassList(queryParams);\n\t\t} else if (queryParams.type) {\n\t\t\tres = await apiGetHistoryList(queryParams);\n\t\t} else {\n\t\t\tconsole.warn(\"classid 和 type 都不存在，无法加载数据\");\n\t\t\treturn;\n\t\t}\n\n\t\t// 判断返回结构是否符合预期\n\t\tif (res && res.data && Array.isArray(res.data.data)) {\n\t\t\tclassList.value = [...classList.value, ...res.data.data];\n\n\t\t\tif (queryParams.pageSize > res.data.data.length) {\n\t\t\t\tnoData.value = true;\n\t\t\t}\n\t\t\tuni.setStorageSync(\"storgClassList\", classList.value);\n\t\t} else {\n\t\t\tconsole.error(\"接口返回结构不符合预期：\", res);\n\t\t\tnoData.value = true;\n\t\t}\n\t} catch (err) {\n\t\tconsole.error(\"getClassList 请求失败：\", err);\n\t\tnoData.value = true;\n\t}\n};\n\r\n//触底加载更多\r\nonReachBottom(()=>{\r\n\tif(noData.value) return;\r\n\tqueryParams.pageNum++\r\n\tgetClassList();\r\n})\r\n\r\n\r\n//分享给好友\r\nonShareAppMessage((e)=>{\r\n\treturn{\r\n\t\ttitle:\"壁纸\",\r\n\t\tpath:\"/pages/classlist/classlist?id=\"+queryParams.classid+\"&name=\"+pageName\r\n\t}\r\n})\r\n//分享到朋友圈\r\nonShareTimeline(()=>{\r\n\treturn{\r\n\t\ttitle:\"壁纸\",\r\n\t\tquery:\"id=\"+queryParams.classid+\"&name=\"+pageName\r\n\t}\r\n})\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n\t.classlist{\r\n\t\t.content{\r\n\t\t\tdisplay: grid;\r\n\t\t\tgrid-template-columns: repeat(3,1fr);\r\n\t\t\tgap: 5rpx;\r\n\t\t\tpadding: 5rpx 5rpx;\r\n\t\t\t.item{\r\n\t\t\t\theight: 440rpx;\r\n\t\t\t    image{\r\n\t\t\t    width: 100%;\r\n\t\t\t\theight: 100%;\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}       \r\n</style>\r\n","import MiniProgramPage from 'C:/Users/liu/Desktop/wx小程序/WallPaper/pages/classlist/classlist.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","onLoad","uni","apiGetClassList","apiGetHistoryList","onReachBottom","onShareAppMessage","onShareTimeline"],"mappings":";;;;;;;;;;;;;;AAqBA,UAAA,YAAAA,cAAA,IAAA,EAAA;AACA,UAAA,SAAAA,cAAA,IAAA,KAAA;AACA,QAAA;AAEA,UAAA,cAAA;AAAA,MACA,SAAA;AAAA,MACA,UAAA;AAAA,IACA;AACAC,kBAAA,OAAA,CAAA,MAAA;AACA,UAAA,EAAA,KAAA,MAAA,OAAA,MAAA,OAAA,KAAA,IAAA;AACA,UAAA;AAAA,oBAAA,OAAA;AACA,UAAA;AAAA,oBAAA,UAAA;AACA,iBAAA;AACAC,oBAAAA,MAAA,sBAAA;AAAA,QACA,OAAA;AAAA,MACA,CAAA;AAEA;IACA,CAAA;AAEA,UAAA,eAAA,YAAA;AACA,UAAA;AACA,YAAA;AAGA,YAAA,YAAA,SAAA;AACA,gBAAA,MAAAC,0BAAA,WAAA;AAAA,QACA,WAAA,YAAA,MAAA;AACA,gBAAA,MAAAC,4BAAA,WAAA;AAAA,QACA,OAAA;AACAF,wBAAAA,MAAA,MAAA,QAAA,uCAAA,4BAAA;AACA;AAAA,QACA;AAGA,YAAA,OAAA,IAAA,QAAA,MAAA,QAAA,IAAA,KAAA,IAAA,GAAA;AACA,oBAAA,QAAA,CAAA,GAAA,UAAA,OAAA,GAAA,IAAA,KAAA,IAAA;AAEA,cAAA,YAAA,WAAA,IAAA,KAAA,KAAA,QAAA;AACA,mBAAA,QAAA;AAAA,UACA;AACAA,wBAAAA,MAAA,eAAA,kBAAA,UAAA,KAAA;AAAA,QACA,OAAA;AACAA,wBAAA,MAAA,MAAA,SAAA,uCAAA,gBAAA,GAAA;AACA,iBAAA,QAAA;AAAA,QACA;AAAA,MACA,SAAA,KAAA;AACAA,sBAAA,MAAA,MAAA,SAAA,uCAAA,sBAAA,GAAA;AACA,eAAA,QAAA;AAAA,MACA;AAAA,IACA;AAGAG,kBAAAA,cAAA,MAAA;AACA,UAAA,OAAA;AAAA;AACA,kBAAA;AACA;IACA,CAAA;AAIAC,kBAAA,kBAAA,CAAA,MAAA;AACA,aAAA;AAAA,QACA,OAAA;AAAA,QACA,MAAA,mCAAA,YAAA,UAAA,WAAA;AAAA,MACA;AAAA,IACA,CAAA;AAEAC,kBAAAA,gBAAA,MAAA;AACA,aAAA;AAAA,QACA,OAAA;AAAA,QACA,OAAA,QAAA,YAAA,UAAA,WAAA;AAAA,MACA;AAAA,IACA,CAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;AC7FA,GAAG,WAAW,eAAe;"}