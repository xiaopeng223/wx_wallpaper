{"version":3,"file":"search.js","sources":["pages/search/search.vue","D:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvc2VhcmNoL3NlYXJjaC52dWU"],"sourcesContent":["<template>\n  <view class=\"searchLayout\">\n    <!-- 搜索框区域 -->\n    <view class=\"searchBarWrapper\">\n      <uni-search-bar\n        v-model=\"keyword\"\n        :focus=\"true\"\n        @confirm=\"onSearch\"\n        @cancel=\"onClear\"\n        @clear=\"onClear\"\n        placeholder=\"搜索关键词\"\n      ></uni-search-bar>\n    </view>\n\n    <!-- 无数据时显示搜索历史 + 推荐 -->\n    <view v-if=\"!classList.length || noSearch\">\n      <view class=\"history\" v-if=\"historySearch.length\">\n        <view class=\"topTitle\">\n          <view class=\"text\">最近搜索</view>\n          <view class=\"icon\" @click=\"removeHistory\">\n            <uni-icons type=\"trash\" size=\"25\"></uni-icons>\n          </view>\n        </view>\n        <view class=\"tabs\">\n          <view\n            class=\"tab\"\n            v-for=\"tab in historySearch\"\n            :key=\"tab\"\n            @click=\"clickTab(tab)\"\n            >{{ tab }}</view\n          >\n        </view>\n      </view>\n\n      <view class=\"recommend\">\n        <view class=\"topTitle\">\n          <view class=\"text\">热门搜索</view>\n        </view>\n        <view class=\"tabs\">\n          <view\n            class=\"tab\"\n            v-for=\"tab in recommendList\"\n            :key=\"tab\"\n            @click=\"clickTab(tab)\"\n            >{{ tab }}</view\n          >\n        </view>\n      </view>\n    </view>\n\n    <!-- 无结果提示 -->\n    <view class=\"noSearch\" v-if=\"noSearch\">\n      <uv-empty\n        mode=\"search\"\n        icon=\"http://cdn.uviewui.com/uview/empty/search.png\"\n      ></uv-empty>\n    </view>\n\n    <!-- 搜索结果 -->\n    <view v-else>\n      <view class=\"list\">\n        <navigator\n          v-for=\"item in classList\"\n          :key=\"item._id\"\n          :url=\"`/pages/preview/preview?id=${item._id}`\"\n          class=\"item\"\n        >\n          <image :src=\"item.smallPicurl\" mode=\"aspectFill\"></image>\n        </navigator>\n      </view>\n\n      <view class=\"loadingLayout\" v-if=\"noData || classList.length\">\n        <uni-load-more :status=\"noData ? 'noMore' : 'loading'\" />\n      </view>\n    </view>\n  </view>\n</template>\n\n<script setup>\nimport { ref } from \"vue\";\nimport { onReachBottom, onUnload } from \"@dcloudio/uni-app\";\nimport { apiSearchData } from \"../../apis/apis.js\";\n\n// 搜索输入内容\nconst keyword = ref(\"\");\n\n// 查询参数\nconst queryParams = ref({\n  pageNum: 1,\n  pageSize: 12,\n  keyword: \"\",\n});\n\n// 搜索记录等数据\nconst historySearch = ref(uni.getStorageSync(\"historySearch\") || []);\nconst recommendList = ref([\"美女\", \"帅哥\", \"宠物\", \"卡通\"]);\nconst noData = ref(false);\nconst noSearch = ref(false);\nconst classList = ref([]);\n\n// 搜索行为\nconst onSearch = () => {\n  if (!keyword.value.trim()) return; // 空值不搜索\n\n  uni.showLoading({ mask: true });\n\n  // 更新历史记录\n  historySearch.value = [\n    ...new Set([keyword.value.trim(), ...historySearch.value]),\n  ].slice(0, 10);\n  uni.setStorageSync(\"historySearch\", historySearch.value);\n\n  // 重置参数并请求\n  initParams(keyword.value.trim());\n  searchData();\n};\n\n// 清空输入\nconst onClear = () => {\n  keyword.value = \"\";\n  initParams();\n};\n\n// 标签点击搜索\nconst clickTab = (val) => {\n  keyword.value = val;\n  onSearch();\n};\n\n// 清空历史\nconst removeHistory = () => {\n  uni.showModal({\n    title: \"是否清空历史搜索？\",\n    success: (res) => {\n      if (res.confirm) {\n        uni.removeStorageSync(\"historySearch\");\n        historySearch.value = [];\n      }\n    },\n  });\n};\n\n// 初始化查询参数\nconst initParams = (val = \"\") => {\n  classList.value = [];\n  noData.value = false;\n  noSearch.value = false;\n  queryParams.value = {\n    pageNum: 1,\n    pageSize: 12,\n    keyword: val,\n  };\n};\n\n// 搜索请求\nconst searchData = async () => {\n  try {\n    const res = await apiSearchData(queryParams.value);\n    const list = res.data?.data || [];\n    classList.value = [...classList.value, ...list];\n    uni.setStorageSync(\"storgClassList\", classList.value);\n\n    if (list.length < queryParams.value.pageSize) noData.value = true;\n    if (list.length === 0 && classList.value.length === 0) noSearch.value = true;\n  } finally {\n    uni.hideLoading();\n  }\n};\n\n// 加载更多\nonReachBottom(() => {\n  if (noData.value) return;\n  queryParams.value.pageNum++;\n  searchData();\n});\n\n// 页面卸载清理缓存\nonUnload(() => {\n  uni.removeStorageSync(\"storgClassList\");\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.searchLayout {\n  position: relative;\n  z-index: 1;\n\n  .searchBarWrapper {\n    padding: 0 10rpx;\n    background: #fff;\n    position: sticky;\n    top: 0;\n    z-index: 99;\n  }\n\n  .topTitle {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    font-size: 32rpx;\n    color: #999;\n  }\n\n  .history,\n  .recommend {\n    padding: 30rpx;\n  }\n\n  .tabs {\n    display: flex;\n    flex-wrap: wrap;\n    align-items: center;\n    padding-top: 20rpx;\n\n    .tab {\n      background: #f4f4f4;\n      font-size: 28rpx;\n      color: #333;\n      padding: 10rpx 28rpx;\n      border-radius: 50rpx;\n      margin-right: 20rpx;\n      margin-top: 20rpx;\n    }\n  }\n\n  .list {\n    display: grid;\n    grid-template-columns: repeat(3, 1fr);\n    gap: 5rpx;\n    padding: 20rpx 5rpx;\n\n    .item {\n      height: 440rpx;\n\n      image {\n        width: 100%;\n        height: 100%;\n        display: block;\n      }\n    }\n  }\n\n  .noSearch {\n    margin-top: 100rpx;\n  }\n}\n</style>\n","import MiniProgramPage from 'C:/Users/liu/Desktop/wx小程序/WallPaper/pages/search/search.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uni","apiSearchData","onReachBottom","onUnload"],"mappings":";;;;;;;;;;;;;;;;;;;;AAoFA,UAAM,UAAUA,cAAAA,IAAI,EAAE;AAGtB,UAAM,cAAcA,cAAAA,IAAI;AAAA,MACtB,SAAS;AAAA,MACT,UAAU;AAAA,MACV,SAAS;AAAA,IACX,CAAC;AAGD,UAAM,gBAAgBA,cAAG,IAACC,cAAG,MAAC,eAAe,eAAe,KAAK,CAAA,CAAE;AACnE,UAAM,gBAAgBD,cAAG,IAAC,CAAC,MAAM,MAAM,MAAM,IAAI,CAAC;AAClD,UAAM,SAASA,cAAAA,IAAI,KAAK;AACxB,UAAM,WAAWA,cAAAA,IAAI,KAAK;AAC1B,UAAM,YAAYA,cAAAA,IAAI,CAAA,CAAE;AAGxB,UAAM,WAAW,MAAM;AACrB,UAAI,CAAC,QAAQ,MAAM,KAAM;AAAE;AAE3BC,oBAAAA,MAAI,YAAY,EAAE,MAAM,KAAM,CAAA;AAG9B,oBAAc,QAAQ;AAAA,QACpB,GAAG,oBAAI,IAAI,CAAC,QAAQ,MAAM,QAAQ,GAAG,cAAc,KAAK,CAAC;AAAA,MAC7D,EAAI,MAAM,GAAG,EAAE;AACbA,oBAAAA,MAAI,eAAe,iBAAiB,cAAc,KAAK;AAGvD,iBAAW,QAAQ,MAAM,KAAM,CAAA;AAC/B;IACF;AAGA,UAAM,UAAU,MAAM;AACpB,cAAQ,QAAQ;AAChB;IACF;AAGA,UAAM,WAAW,CAAC,QAAQ;AACxB,cAAQ,QAAQ;AAChB;IACF;AAGA,UAAM,gBAAgB,MAAM;AAC1BA,oBAAAA,MAAI,UAAU;AAAA,QACZ,OAAO;AAAA,QACP,SAAS,CAAC,QAAQ;AAChB,cAAI,IAAI,SAAS;AACfA,gCAAI,kBAAkB,eAAe;AACrC,0BAAc,QAAQ;UACvB;AAAA,QACF;AAAA,MACL,CAAG;AAAA,IACH;AAGA,UAAM,aAAa,CAAC,MAAM,OAAO;AAC/B,gBAAU,QAAQ;AAClB,aAAO,QAAQ;AACf,eAAS,QAAQ;AACjB,kBAAY,QAAQ;AAAA,QAClB,SAAS;AAAA,QACT,UAAU;AAAA,QACV,SAAS;AAAA,MACb;AAAA,IACA;AAGA,UAAM,aAAa,YAAY;;AAC7B,UAAI;AACF,cAAM,MAAM,MAAMC,UAAAA,cAAc,YAAY,KAAK;AACjD,cAAM,SAAO,SAAI,SAAJ,mBAAU,SAAQ,CAAA;AAC/B,kBAAU,QAAQ,CAAC,GAAG,UAAU,OAAO,GAAG,IAAI;AAC9CD,sBAAAA,MAAI,eAAe,kBAAkB,UAAU,KAAK;AAEpD,YAAI,KAAK,SAAS,YAAY,MAAM;AAAU,iBAAO,QAAQ;AAC7D,YAAI,KAAK,WAAW,KAAK,UAAU,MAAM,WAAW;AAAG,mBAAS,QAAQ;AAAA,MAC5E,UAAY;AACRA,sBAAG,MAAC,YAAW;AAAA,MAChB;AAAA,IACH;AAGAE,kBAAAA,cAAc,MAAM;AAClB,UAAI,OAAO;AAAO;AAClB,kBAAY,MAAM;AAClB;IACF,CAAC;AAGDC,kBAAAA,SAAS,MAAM;AACbH,0BAAI,kBAAkB,gBAAgB;AAAA,IACxC,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AClLD,GAAG,WAAW,eAAe;"}